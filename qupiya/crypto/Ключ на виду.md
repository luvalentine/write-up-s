# Ключ на виду

## Условие
nc 188.130.238.33 14001


Пользователь отправляет сообщение в hex-формате, после чего сервер шифрует данные с помощью AES.

Перед шифрованием открытый текст формируется так:
KEY || USER_MESSAGE || FLAG



Где `KEY` — случайные 16 байт, генерируемые при подключении, а `FLAG` — секретный флаг.

---

## Анализ
Используется режим AES-ECB, который шифрует данные блоками по 16 байт независимо друг от друга.  
В рамках одного подключения ключ остаётся неизменным.

Длина `KEY` равна ровно 16 байтам, то есть он полностью занимает первый блок. Это значит, что пользовательский ввод начинается строго с начала второго блока, а сразу после него идёт флаг.

Таким образом, сервис позволяет шифровать управляемый пользователем текст, расположенный рядом с секретными данными, при фиксированном ключе.

---

## Уязвимость
Использование AES в режиме ECB при наличии управляемого ввода рядом с секретом (`FLAG`).

Это позволяет применить атаку типа *byte-at-a-time ECB*.

---

## Решение
Флаг восстанавливается по одному байту:

Сначала подбирается длина пользовательского сообщения так, чтобы очередной неизвестный байт флага оказался последним байтом блока.  
Затем этот блок шифртекста запоминается.

После этого перебираются все возможные значения байта (0–255), которые подставляются вместо неизвестного.  
Когда блоки шифртекста совпадают, значение байта найдено.

Процедура повторяется для всех байт флага.  
Первый блок всегда игнорируется, так как он содержит только `KEY`.

